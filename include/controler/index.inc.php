<?php

// -----------------------------------------------------------------------------------------------------------------#
// ---------------------------------------Archivos necesarios Require Include---------------------------------------#
// -----------------------------------------------------------------------------------------------------------------#
require (LIB_CONEXION);
//require_once FOLDER_MODEL_WSTAM . "ws.class.WSTMdoLicValidaUsuario.inc.php";
/*
 * require(FOLDER_MODEL_WS . "ws.class.AccountService.isUsernameExists.inc.php");
 * require(FOLDER_MODEL_WS . "ws.class.AccountServiceGetBalance.inc.php");
 * require(FOLDER_MODEL_WS . "ws.class.AccountService.login.inc.php");
 * require(FOLDER_MODEL_WS . "ws.class.AccountService.getInfo.inc.php");
 * require FOLDER_MODEL_WS . "ws.class.AccountService.getAccountCRMLanguage.inc.php";
 */



require FOLDER_MODEL_EXTEND . "model.login_user.inc.php";
//require 'admincuentas.php';

// -----------------------------------------------------------------------------------------------------------------#
// --------------------------------------------Inicializacion de control--------------------------------------------#
// -----------------------------------------------------------------------------------------------------------------#

// -----------------------------------------------------------------------------------------------------------------#
// -----------------------------------------------------------------------------------------------------------------#

// -----------------------------------------------------------------------------------------------------------------#
// ----------------------------------------------------Funciones----------------------------------------------------#
// -----------------------------------------------------------------------------------------------------------------#

// -----------------------------------------------------------------------------------------------------------------#
// -----------------------------------------------------------------------------------------------------------------#

// -----------------------------------------------------------------------------------------------------------------#
// ---------------------------------------------------Seccion AJAX--------------------------------------------------#
// -----------------------------------------------------------------------------------------------------------------#

$xajax = new xajax();

function ingresar($user, $password)
{
	global $dbLink;
	$r = new xajaxResponse();
	$Usuario=new ModeloLogin_user();
	
	if (!$Usuario->login($user, $password)){
	    $r->mostrarError("Acceso degnegado");
	    return $r;
	}
	
	$arrDatos = $Usuario->getArray();

	
	$objSession = new clsSession();
	$objSession->updateTime();
	$objSession->setObjetoGetInfo($arrDatos);
	
	$_SESSION['clientLanguage'] = "es_MX";
	$_SESSION['objSession'] = serialize($objSession);
	
	$r->redirect("dashboard.php",3);
	return $r;
}

$xajax->registerFunction("ingresar");

$xajax->processRequest();

// -----------------------------------------------------------------------------------------------------------------#
// -----------------------------------------------------------------------------------------------------------------#

// -----------------------------------------------------------------------------------------------------------------#
// -------------------------------------------Inicializacion de variables-------------------------------------------#
// -----------------------------------------------------------------------------------------------------------------#

// -----------------------------------------------------------------------------------------------------------------#
// ------------------------------------- JavaScript array initialization ---------------------------------------#
// -----------------------------------------------------------------------------------------------------------------#
$_JAVASCRIPT_OUT = "";


